
<main class="workout-content">
  <!-- Hero-Bild oben -->
  <header class="hero">
    <div class="hero-overlay">
      <div class="hero-meta">
        <button class="chip">25. Feb</button>
        <button class="chip">Dungeon · Tokio</button>
        <div class="hero-actions">
          <button class="primary" (click)="startEmpty()">Ein leeres Workout beginnen</button>
          <button class="secondary" (click)="createTemplate()">Neue Vorlage anlegen</button>
        </div>
      </div>
    </div>
  </header>

  <div class="workout-page">
    <!-- Ordner-Leiste -->
    <section class="folder-strip">
      <div class="chips-scroll">
        <button class="folder-chip"
                [class.active]="isSelected('ALL')"
                (click)="selectFolder('ALL')">
          <span class="tab"></span><span class="name">Alle</span>
        </button>

        <button class="folder-chip"
                [class.active]="isSelected('NONE')"
                (click)="selectFolder('NONE')">
          <span class="tab"></span><span class="name">Ohne Ordner</span>
        </button>

        <button class="folder-chip"
                *ngFor="let f of folders(); trackBy: trackByFolder"
                [class.active]="isSelected(f.id)"
                (click)="selectFolder(f.id)">
          <span class="tab"></span><span class="name">{{ f.name }}</span>
        </button>
      </div>
    </section>

    <!-- Toolbar -->
    <section class="toolbar">
      <div class="left"><h3>Vorlagen</h3></div>
      <div class="right">
        <input class="folder-input"
               type="text"
               placeholder="Neuen Ordner…"
               [(ngModel)]="newFolderName"
               (keyup.enter)="addFolder()" />
        <button class="icon" title="Ordner anlegen" (click)="addFolder()">＋</button>
      </div>
    </section>

    <!-- Vorlagen-Kacheln -->
    <section class="templates">
      <h3 *ngIf="selectedFolderId() === 'ALL'">Alle Vorlagen</h3>
      <h3 *ngIf="selectedFolderId() === 'NONE'">Vorlagen ohne Ordner</h3>
      <h3 *ngIf="selectedFolderId() !== 'ALL' && selectedFolderId() !== 'NONE'">
          {{ folderName(selectedFolderId()) }}
      </h3>

      <div class="card-grid">
        <div class="card"
             *ngFor="let t of filteredTemplates(); trackBy: trackByTemplate">

          <div class="card-title">{{ t.name }}</div>

          <div class="card-sub">{{ preview(t) }}</div>

          <div class="card-meta" *ngIf="t.lastUsed">
            Zuletzt benutzt: {{ t.lastUsed | date:'dd.MM.yyyy' }}
          </div>

          <div class="card-actions">
            <button class="primary" (click)="startFromTemplate(t)">Starten</button>
            <button class="ghost"   (click)="duplicate(t)">Kopieren</button>
            <button class="ghost"   (click)="archive(t)">Archivieren</button>
            <button class="danger"  (click)="remove(t)">Löschen</button>
          </div>

          <div class="move-row">
            <span>In Ordner:</span>
            <button class="mini"
                    *ngFor="let f of folders(); trackBy: trackByFolder"
                    (click)="moveToFolder(t, f.id)">
              {{ f.name }}
            </button>
            <button class="mini" (click)="moveToFolder(t, null)">Ohne Ordner</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Archiv -->
    <section class="archive" *ngIf="archivedTemplates().length > 0">
      <h4>Archiv</h4>
      <div class="card-grid list">
        <div class="card muted"
             *ngFor="let t of archivedTemplates(); trackBy: trackByTemplate">
          <div class="card-title">{{ t.name }}</div>
          <div class="card-sub">{{ preview(t) }}</div>
          <div class="card-actions">
            <button class="mini" (click)="unarchive(t)">Wiederherstellen</button>
            <button class="mini danger" (click)="remove(t)">Löschen</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Übungen aus MongoDB -->
    <section class="mongo-exercises">
      <hr />
      <h3>Übungen (aus Datenbank)</h3>

      <!-- Filter -->
      <div class="filters" style="display:flex;gap:8px;margin:8px 0;flex-wrap:wrap;">
        <input
          [ngModel]="wQuery()"
          (ngModelChange)="wQuery.set($event)"
          placeholder="Suche Name / Muskel…" />

        <select
          [ngModel]="wType()"
          (ngModelChange)="wType.set($event)">
          <option value="">Alle Typen</option>
          <option>Push</option><option>Pull</option><option>Legs</option>
          <option>Core</option><option>Full Body</option><option>Conditioning</option>
        </select>

        <select
          [ngModel]="wDifficulty()"
          (ngModelChange)="wDifficulty.set($event)">
          <option value="">Alle Level</option>
          <option>Beginner</option><option>Intermediate</option><option>Advanced</option>
        </select>
      </div>

      <!-- Fehlermeldung -->
      <p *ngIf="workoutError()" class="err">{{ workoutError() }}</p>

      <!-- Workouts -->
      <div class="card-grid">
        <div class="card" *ngFor="let w of filteredWorkouts()">
          <div class="card-title">{{ w.name }}</div>
          <div class="card-sub">Muskelgruppe: {{ w.muscleGroup }}</div>
          <div class="card-meta">
            Schwierigkeit: {{ w.difficulty }} · Typ: {{ w.type }}
          </div>
          <div class="card-meta">Equipment: {{ w.equipment }}</div>
          <div class="card-meta">Risiko-Level: {{ w.riskLevel }}</div>
        </div>
      </div>
    </section>
  </div>
</main>